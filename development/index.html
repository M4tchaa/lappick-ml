<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>LapPick - Rekomendasi Laptop Multimedia</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    .card {
      transition: transform 0.3s;
    }
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 0.5rem 1rem rgba(0,0,0,.15);
    }
    .recommended {
      border: 2px solid #198754;
    }
    .mixed {
      border: 2px solid #ffc107;
    }
    .minimum {
      border: 2px solid #0dcaf0;
    }
    .category-badge {
      position: absolute;
      top: 10px;
      right: 10px;
      font-weight: bold;
    }
    .progress {
      height: 8px;
    }
  </style>
</head>
<body class="bg-light">
  <div class="container py-5">
    <div class="text-center mb-4">
      <h1 class="mb-3">ðŸ’» LapPick - Rekomendasi Laptop Multimedia</h1>
      <p class="lead">Dapatkan rekomendasi laptop terbaik untuk kebutuhan multimedia</p>
    </div>
    
    <div class="card p-4 mb-4">
      <div class="mb-3">
        <label for="inputTeks" class="form-label fw-bold">Deskripsikan kebutuhan Anda:</label>
        <input type="text" id="inputTeks" class="form-control form-control-lg" 
               placeholder="Contoh: 'Laptop untuk editing video dengan budget 15 juta'" />
      </div>
      <button class="btn btn-primary btn-lg w-100" onclick="dapatkanRekomendasi()">
        Dapatkan Rekomendasi
      </button>
    </div>

    <div id="hasil" class="mt-4"></div>
    <div id="loading" class="text-center my-4 d-none">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p class="mt-2">Mencari rekomendasi terbaik untuk Anda...</p>
    </div>
  </div>

  <script>
    async function dapatkanRekomendasi() {
      const teks = document.getElementById("inputTeks").value.trim();
      const hasilDiv = document.getElementById("hasil");
      const loadingDiv = document.getElementById("loading");
      
      if (!teks) {
        hasilDiv.innerHTML = `<div class="alert alert-warning">Silakan masukkan deskripsi kebutuhan Anda</div>`;
        return;
      }
      
      hasilDiv.innerHTML = "";
      loadingDiv.classList.remove("d-none");
      
      try {
        const response = await fetch(`http://localhost:5000/rekomendasi?teks=${encodeURIComponent(teks)}`);
        const data = await response.json();
        loadingDiv.classList.add("d-none");
        
        if (data.error) {
          hasilDiv.innerHTML = `<div class="alert alert-danger">${data.error}</div>`;
          return;
        }
        
        if (data.rekomendasi && data.rekomendasi.length > 0) {
          renderHasil(data.rekomendasi);
        } else if (data.message) {
          hasilDiv.innerHTML = `<div class="alert alert-info">${data.message}</div>`;
        } else {
          hasilDiv.innerHTML = `<div class="alert alert-warning">Tidak ditemukan rekomendasi untuk kebutuhan Anda</div>`;
        }
      } catch (err) {
        loadingDiv.classList.add("d-none");
        hasilDiv.innerHTML = `<div class="alert alert-danger">Terjadi kesalahan: ${err.message}</div>`;
        console.error(err);
      }
    }
    
    function renderHasil(rekomendasi) {
      const hasilDiv = document.getElementById("hasil");
      
      // Header hasil
      let html = `
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h3>Hasil Rekomendasi</h3>
          <span class="badge bg-primary">${rekomendasi.length} laptop ditemukan</span>
        </div>
        <div class="row g-4">
      `;
      
      // Card untuk setiap laptop
      rekomendasi.forEach(laptop => {
        const categoryClass = laptop.Category?.toLowerCase() || 'unknown';
        const matchPercent = Math.min(100, Math.round(laptop.Match_Score * 100));
        
        html += `
          <div class="col-md-6 col-lg-4">
            <div class="card h-100 ${categoryClass}">
              <span class="badge ${getCategoryBadgeClass(laptop.Category)} category-badge">
                ${laptop.Category}
              </span>
              <div class="card-body">
                <h5 class="card-title">${laptop.Brand} ${laptop.Model}</h5>
                <h6 class="card-subtitle mb-3 text-success">Rp ${laptop["Final Price"].toLocaleString("id-ID")}</h6>
                
                <div class="mb-3">
                  <small class="text-muted">Kecocokan:</small>
                  <div class="progress">
                    <div class="progress-bar" role="progressbar" 
                         style="width: ${matchPercent}%" 
                         aria-valuenow="${matchPercent}" 
                         aria-valuemin="0" 
                         aria-valuemax="100">
                    </div>
                  </div>
                  <small>${matchPercent}% sesuai kebutuhan</small>
                </div>
                
                <ul class="list-group list-group-flush">
                  <li class="list-group-item d-flex justify-content-between">
                    <span>CPU:</span>
                    <strong>${laptop.CPU}</strong>
                  </li>
                  <li class="list-group-item d-flex justify-content-between">
                    <span>GPU:</span>
                    <strong>${laptop.GPU}</strong>
                  </li>
                  <li class="list-group-item d-flex justify-content-between">
                    <span>RAM:</span>
                    <strong>${laptop.RAM} GB</strong>
                  </li>
                  <li class="list-group-item d-flex justify-content-between">
                    <span>Storage:</span>
                    <strong>${laptop.Storage} GB ${laptop["Storage type"]}</strong>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        `;
      });
      
      html += `</div>`;
      hasilDiv.innerHTML = html;
    }
    
    function getCategoryBadgeClass(category) {
      switch(category) {
        case "Recommended": return "bg-success";
        case "Mixed": return "bg-warning text-dark";
        case "Minimum": return "bg-info text-dark";
        default: return "bg-secondary";
      }
    }
    
    // Enable Enter key to submit
    document.getElementById("inputTeks").addEventListener("keyup", function(event) {
      if (event.key === "Enter") {
        dapatkanRekomendasi();
      }
    });
  </script>
</body>
</html>